<Window x:Class="CalcApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:viewModels="clr-namespace:CalcApp.ViewModels"
        Title="ðŸ§® Modern KalkulÃ¡tor" Width="380" MinWidth="360" Height="560" MinHeight="520"
        ResizeMode="CanResize"
        Background="{DynamicResource WindowBackgroundBrush}"
        KeyDown="Window_KeyDown" Focusable="True"
        WindowStartupLocation="CenterScreen"
        AllowsTransparency="False">

    <Window.DataContext>
        <viewModels:CalculatorViewModel />
    </Window.DataContext>

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Themes/MaterialTheme.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" /> <!-- Top: Theme toggle -->
            <RowDefinition Height="Auto" /> <!-- Display -->
            <RowDefinition Height="Auto" /> <!-- Memory area -->
            <RowDefinition Height="*" />    <!-- Keypad -->
        </Grid.RowDefinitions>

        <!-- Top controls: Theme toggle and Speech toggle -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,0,0,8">
            <Button x:Name="ThemeToggle" Width="90" Height="36" Margin="0,0,8,0" Click="ThemeToggle_Click"
                    Content="ðŸŒ™ Dark" FontSize="12" FontWeight="Normal" Cursor="Hand">
            <Button.RenderTransform>
                <ScaleTransform x:Name="ThemeButtonScale" ScaleX="1" ScaleY="1" CenterX="45" CenterY="19" />
            </Button.RenderTransform>
            <Button.Triggers>
                <EventTrigger RoutedEvent="MouseEnter">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation Storyboard.TargetName="ThemeButtonScale" Storyboard.TargetProperty="ScaleX" To="1.08" Duration="0:0:0.2">
                                <DoubleAnimation.EasingFunction>
                                    <CubicEase EasingMode="EaseOut" />
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>
                            <DoubleAnimation Storyboard.TargetName="ThemeButtonScale" Storyboard.TargetProperty="ScaleY" To="1.08" Duration="0:0:0.2">
                                <DoubleAnimation.EasingFunction>
                                    <CubicEase EasingMode="EaseOut" />
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
                <EventTrigger RoutedEvent="MouseLeave">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation Storyboard.TargetName="ThemeButtonScale" Storyboard.TargetProperty="ScaleX" To="1.0" Duration="0:0:0.2">
                                <DoubleAnimation.EasingFunction>
                                    <CubicEase EasingMode="EaseIn" />
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>
                            <DoubleAnimation Storyboard.TargetName="ThemeButtonScale" Storyboard.TargetProperty="ScaleY" To="1.0" Duration="0:0:0.2">
                                <DoubleAnimation.EasingFunction>
                                    <CubicEase EasingMode="EaseIn" />
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </Button.Triggers>
            </Button>

            <!-- Speech toggle: enables/disables voice control (magyar) -->
            <ToggleButton x:Name="SpeechToggle" Width="120" Height="36" VerticalAlignment="Top"
                          Content="ðŸŽ¤ BeszÃ©d: Be" FontSize="12" FontWeight="Normal" Cursor="Hand"
                          Checked="SpeechToggle_Checked" Unchecked="SpeechToggle_Unchecked" />
        </StackPanel>

        <!-- Display Area -->
        <Grid Grid.Row="1">
            <Border CornerRadius="18" BorderBrush="{DynamicResource ButtonBackgroundBrush}"
                    BorderThickness="2" Padding="12"
                    Background="{DynamicResource BorderBackgroundBrush}">
               <Border.Effect>
                    <!-- cheaper shadow settings -->
                    <DropShadowEffect Color="Black" Opacity="0.35" BlurRadius="8" ShadowDepth="3" Direction="270" />
                </Border.Effect>
                <TextBox x:Name="Display" FontSize="36" FontWeight="Normal"
                         HorizontalAlignment="Stretch" VerticalAlignment="Center"
                         Text="{Binding Display, Mode=TwoWay}" TextAlignment="Right" IsReadOnly="True" BorderThickness="0"
                         Background="Transparent" Foreground="{DynamicResource BorderForegroundBrush}"
                         UseLayoutRounding="True" SnapsToDevicePixels="True"
                         TextOptions.TextFormattingMode="Display" />
            </Border>
        </Grid>

        <!-- Memory Area -->
        <Border Grid.Row="2" Margin="0,12,0,0" Padding="14"
                Background="{DynamicResource BorderBackgroundBrush}"
                CornerRadius="18"
                BorderBrush="{DynamicResource ButtonBackgroundBrush}"
                BorderThickness="2"
                SnapsToDevicePixels="True">
            <Border.Effect>
                <DropShadowEffect Color="Black" Opacity="0.25" BlurRadius="6" ShadowDepth="3" Direction="270" />
            </Border.Effect>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <TextBlock Text="ðŸ’¾ MemÃ³ria" FontSize="16" FontWeight="SemiBold"
                           Margin="0,0,0,8" Foreground="{DynamicResource BorderForegroundBrush}" />
                <ListBox x:Name="MemoryList" Grid.Row="1" ItemsSource="{Binding MemoryItems}"
                         Foreground="{DynamicResource BorderForegroundBrush}"
                         Background="Transparent" BorderThickness="0"
                         FontSize="12" FontWeight="Normal"
                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                         VirtualizingPanel.IsVirtualizing="True"
                         VirtualizingPanel.VirtualizationMode="Recycling" />

            </Grid>
        </Border>

        <!-- Keypad -->
        <Grid Grid.Row="3" Margin="0,12,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Row 0: functions -->
            <Button Content="sin" Grid.Row="0" Grid.Column="0" Command="{Binding SinCommand}" />
            <Button Content="cos" Grid.Row="0" Grid.Column="1" Command="{Binding CosCommand}" />
            <Button Content="tan" Grid.Row="0" Grid.Column="2" Command="{Binding TanCommand}" />
            <Button Content="âˆš" Grid.Row="0" Grid.Column="3" Command="{Binding SqrtCommand}" />

            <!-- Row 1: memory & factorial -->
            <Button Content="n!" Grid.Row="1" Grid.Column="0" Command="{Binding FactorialCommand}" />
            <Button Content="M+" Grid.Row="1" Grid.Column="1" Command="{Binding MemoryAddCommand}" />
            <Button Content="M-" Grid.Row="1" Grid.Column="2" Command="{Binding MemorySubtractCommand}" />
            <Button Content="MR" Grid.Row="1" Grid.Column="3" Command="{Binding MemoryRecallCommand}" />

            <!-- Row 2: clear / percent -->
            <Button Content="MC" Grid.Row="2" Grid.Column="0" Command="{Binding MemoryClearCommand}" />
            <Button Content="C" Grid.Row="2" Grid.Column="1" Command="{Binding ClearCommand}" />
            <Button Content="âŒ«" Grid.Row="2" Grid.Column="2" Command="{Binding DeleteCommand}" />
            <Button Content="%" Grid.Row="2" Grid.Column="3" Command="{Binding PercentCommand}" />

            <!-- Row 3 -->
            <Button Content="7" Tag="7" Grid.Row="3" Grid.Column="0" Command="{Binding DigitCommand}" CommandParameter="7" />
            <Button Content="8" Tag="8" Grid.Row="3" Grid.Column="1" Command="{Binding DigitCommand}" CommandParameter="8" />
            <Button Content="9" Tag="9" Grid.Row="3" Grid.Column="2" Command="{Binding DigitCommand}" CommandParameter="9" />
            <Button Content="Ã·" Grid.Row="3" Grid.Column="3" Command="{Binding OperatorCommand}" CommandParameter="/" />

            <!-- Row 4 -->
            <Button Content="4" Tag="4" Grid.Row="4" Grid.Column="0" Command="{Binding DigitCommand}" CommandParameter="4" />
            <Button Content="5" Tag="5" Grid.Row="4" Grid.Column="1" Command="{Binding DigitCommand}" CommandParameter="5" />
            <Button Content="6" Tag="6" Grid.Row="4" Grid.Column="2" Command="{Binding DigitCommand}" CommandParameter="6" />
            <Button Content="Ã—" Grid.Row="4" Grid.Column="3" Command="{Binding OperatorCommand}" CommandParameter="*" />

            <!-- Row 5 -->
           <Button Content="1" Tag="1" Grid.Row="5" Grid.Column="0" Command="{Binding DigitCommand}" CommandParameter="1" />
            <Button Content="2" Tag="2" Grid.Row="5" Grid.Column="1" Command="{Binding DigitCommand}" CommandParameter="2" />
            <Button Content="3" Tag="3" Grid.Row="5" Grid.Column="2" Command="{Binding DigitCommand}" CommandParameter="3" />
            <Button Content="âˆ’" Grid.Row="5" Grid.Column="3" Command="{Binding OperatorCommand}" CommandParameter="-" />

            <!-- Row 6 -->
            <Button Content="." Grid.Row="6" Grid.Column="2" Command="{Binding DecimalCommand}" />
            <Button Content="0" Tag="0" Grid.Row="6" Grid.Column="0" Grid.ColumnSpan="2" Command="{Binding DigitCommand}" CommandParameter="0" />

            <!-- Row 7 -->
            <Button Content="Â±" Grid.Row="7" Grid.Column="0" Command="{Binding SignCommand}" />
            <Button Content="=" Grid.Row="7" Grid.Column="1" Grid.ColumnSpan="3" Command="{Binding EqualsCommand}"
                    Background="{DynamicResource AccentButtonBrush}" />
        </Grid>

    </Grid>
</Window>