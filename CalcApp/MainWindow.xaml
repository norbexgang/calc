<Window x:Class="CalcApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ðŸ§® Modern KalkulÃ¡tor" Width="380" MinWidth="360" Height="560" MinHeight="520"
        ResizeMode="CanResize"
        Background="{DynamicResource WindowBackgroundBrush}"
        KeyDown="Window_KeyDown" Focusable="True"
        WindowStartupLocation="CenterScreen"
        AllowsTransparency="False">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Themes/MaterialTheme.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!-- Global Button Style with ControlTemplate-based animations (no TargetName in Setters) -->
            <Style TargetType="Button">
                <Setter Property="Margin" Value="4" />
                <Setter Property="FontSize" Value="18" />
                <Setter Property="FontWeight" Value="Normal" />
                <Setter Property="Background" Value="{DynamicResource ButtonBackgroundBrush}" />
                <Setter Property="Foreground" Value="{DynamicResource ButtonForegroundBrush}" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Padding" Value="8" />
                <Setter Property="Cursor" Value="Hand" />
                <Setter Property="Effect">
                    <Setter.Value>
                        <DropShadowEffect Color="Black" Opacity="0.35" BlurRadius="10" ShadowDepth="4" Direction="270" />
                    </Setter.Value>
                </Setter>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Grid>
                                <Border x:Name="ButtonBorder"
                                        Background="{TemplateBinding Background}"
                                        CornerRadius="16"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" RecognizesAccessKey="True" />
                                </Border>
                                <Border x:Name="HighlightBorder" CornerRadius="16" Background="White" Opacity="0" IsHitTestVisible="False" />
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="ButtonBorder" Property="Opacity" Value="0.92" />
                                    <Setter TargetName="HighlightBorder" Property="Opacity" Value="0.08" />
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="ButtonBorder" Property="Opacity" Value="0.75" />
                                    <Setter TargetName="HighlightBorder" Property="Opacity" Value="0.15" />
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter TargetName="ButtonBorder" Property="Opacity" Value="0.5" />
                                </Trigger>

                                <!-- EventTriggers inside ControlTemplate.Triggers are valid and target template parts -->
                                <EventTrigger RoutedEvent="MouseEnter">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="ButtonBorder" Storyboard.TargetProperty="Opacity" To="0.92" Duration="0:0:0.18">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="HighlightBorder" Storyboard.TargetProperty="Opacity" To="0.08" Duration="0:0:0.18">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                                <EventTrigger RoutedEvent="MouseLeave">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="ButtonBorder" Storyboard.TargetProperty="Opacity" To="1.0" Duration="0:0:0.18">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseIn" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="HighlightBorder" Storyboard.TargetProperty="Opacity" To="0.0" Duration="0:0:0.18">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseIn" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                                <EventTrigger RoutedEvent="PreviewMouseLeftButtonDown">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="ButtonBorder" Storyboard.TargetProperty="Opacity" To="0.75" Duration="0:0:0.08">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseIn" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="HighlightBorder" Storyboard.TargetProperty="Opacity" To="0.15" Duration="0:0:0.08">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseIn" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                                <EventTrigger RoutedEvent="PreviewMouseLeftButtonUp">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="ButtonBorder" Storyboard.TargetProperty="Opacity" To="0.92" Duration="0:0:0.12">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="HighlightBorder" Storyboard.TargetProperty="Opacity" To="0.08" Duration="0:0:0.12">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

        </ResourceDictionary>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" /> <!-- Top: Theme toggle -->
            <RowDefinition Height="Auto" /> <!-- Display -->
            <RowDefinition Height="Auto" /> <!-- Memory area -->
            <RowDefinition Height="*" />    <!-- Keypad -->
        </Grid.RowDefinitions>

        <!-- Theme Toggle Button -->
        <Button x:Name="ThemeToggle" Grid.Row="0" HorizontalAlignment="Right" VerticalAlignment="Top"
                Width="90" Height="36" Margin="0,0,0,8" Click="ThemeToggle_Click"
                Content="ðŸŒ™ Dark" FontSize="12" FontWeight="Normal" Cursor="Hand">
            <Button.RenderTransform>
                <ScaleTransform x:Name="ThemeButtonScale" ScaleX="1" ScaleY="1" CenterX="45" CenterY="19" />
            </Button.RenderTransform>
            <Button.Triggers>
                <EventTrigger RoutedEvent="MouseEnter">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation Storyboard.TargetName="ThemeButtonScale" Storyboard.TargetProperty="ScaleX" To="1.08" Duration="0:0:0.2">
                                <DoubleAnimation.EasingFunction>
                                    <CubicEase EasingMode="EaseOut" />
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>
                            <DoubleAnimation Storyboard.TargetName="ThemeButtonScale" Storyboard.TargetProperty="ScaleY" To="1.08" Duration="0:0:0.2">
                                <DoubleAnimation.EasingFunction>
                                    <CubicEase EasingMode="EaseOut" />
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
                <EventTrigger RoutedEvent="MouseLeave">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation Storyboard.TargetName="ThemeButtonScale" Storyboard.TargetProperty="ScaleX" To="1.0" Duration="0:0:0.2">
                                <DoubleAnimation.EasingFunction>
                                    <CubicEase EasingMode="EaseIn" />
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>
                            <DoubleAnimation Storyboard.TargetName="ThemeButtonScale" Storyboard.TargetProperty="ScaleY" To="1.0" Duration="0:0:0.2">
                                <DoubleAnimation.EasingFunction>
                                    <CubicEase EasingMode="EaseIn" />
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </Button.Triggers>
        </Button>

        <!-- Display Area -->
        <Grid Grid.Row="1">
            <Border CornerRadius="18" BorderBrush="{DynamicResource ButtonBackgroundBrush}"
                    BorderThickness="2" Padding="12"
                    Background="{DynamicResource BorderBackgroundBrush}">
               <Border.Effect>
                    <!-- cheaper shadow settings -->
                    <DropShadowEffect Color="Black" Opacity="0.35" BlurRadius="8" ShadowDepth="3" Direction="270" />
                </Border.Effect>
                <TextBox x:Name="Display" FontSize="36" FontWeight="Normal"
                         HorizontalAlignment="Stretch" VerticalAlignment="Center"
                         Text="0" TextAlignment="Right" IsReadOnly="True" BorderThickness="0"
                         Background="Transparent" Foreground="{DynamicResource BorderForegroundBrush}"
                         UseLayoutRounding="True" SnapsToDevicePixels="True"
                         TextOptions.TextFormattingMode="Display" />


            </Border>
        </Grid>

        <!-- Memory Area -->
        <Border Grid.Row="2" Margin="0,12,0,0" Padding="14"
                Background="{DynamicResource BorderBackgroundBrush}"
                CornerRadius="18"
                BorderBrush="{DynamicResource ButtonBackgroundBrush}"
                BorderThickness="2"
                SnapsToDevicePixels="True">
            <Border.Effect>
                <DropShadowEffect Color="Black" Opacity="0.25" BlurRadius="6" ShadowDepth="3" Direction="270" />
            </Border.Effect>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <TextBlock Text="ðŸ’¾ MemÃ³ria" FontSize="16" FontWeight="SemiBold"
                           Margin="0,0,0,8" Foreground="{DynamicResource BorderForegroundBrush}" />
                <ListBox x:Name="MemoryList" Grid.Row="1"
                         Foreground="{DynamicResource BorderForegroundBrush}"
                         Background="Transparent" BorderThickness="0"
                         FontSize="12" FontWeight="Normal"
                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                         VirtualizingPanel.IsVirtualizing="True"
                         VirtualizingPanel.VirtualizationMode="Recycling" />

            </Grid>
        </Border>

        <!-- Keypad -->
        <Grid Grid.Row="3" Margin="0,12,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Row 0: functions -->
            <Button Content="sin" Grid.Row="0" Grid.Column="0" Click="Sin_Click" />
            <Button Content="cos" Grid.Row="0" Grid.Column="1" Click="Cos_Click" />
            <Button Content="tan" Grid.Row="0" Grid.Column="2" Click="Tan_Click" />
            <Button Content="âˆš" Grid.Row="0" Grid.Column="3" Click="Sqrt_Click" />

            <!-- Row 1: memory & factorial -->
            <Button Content="n!" Grid.Row="1" Grid.Column="0" Click="Factorial_Click" />
            <Button Content="M+" Grid.Row="1" Grid.Column="1" Click="MemoryAdd_Click" />
            <Button Content="M-" Grid.Row="1" Grid.Column="2" Click="MemorySubtract_Click" />
            <Button Content="MR" Grid.Row="1" Grid.Column="3" Click="MemoryRecall_Click" />

            <!-- Row 2: clear / percent -->
            <Button Content="MC" Grid.Row="2" Grid.Column="0" Click="MemoryClear_Click" />
            <Button Content="C" Grid.Row="2" Grid.Column="1" Click="Clear_Click" />
            <Button Content="âŒ«" Grid.Row="2" Grid.Column="2" Click="Delete_Click" />
            <Button Content="%" Grid.Row="2" Grid.Column="3" Click="Percent_Click" />

            <!-- Row 3 -->
            <Button Content="7" Grid.Row="3" Grid.Column="0" Click="Digit_Click" />
            <Button Content="8" Grid.Row="3" Grid.Column="1" Click="Digit_Click" />
            <Button Content="9" Grid.Row="3" Grid.Column="2" Click="Digit_Click" />
            <Button Content="Ã·" Grid.Row="3" Grid.Column="3" Click="Operator_Click" Tag="/" />

            <!-- Row 4 -->
            <Button Content="4" Grid.Row="4" Grid.Column="0" Click="Digit_Click" />
            <Button Content="5" Grid.Row="4" Grid.Column="1" Click="Digit_Click" />
            <Button Content="6" Grid.Row="4" Grid.Column="2" Click="Digit_Click" />
            <Button Content="Ã—" Grid.Row="4" Grid.Column="3" Click="Operator_Click" Tag="*" />

            <!-- Row 5 -->
            <Button Content="1" Grid.Row="5" Grid.Column="0" Click="Digit_Click" />
            <Button Content="2" Grid.Row="5" Grid.Column="1" Click="Digit_Click" />
            <Button Content="3" Grid.Row="5" Grid.Column="2" Click="Digit_Click" />
            <Button Content="âˆ’" Grid.Row="5" Grid.Column="3" Click="Operator_Click" Tag="-" />

            <!-- Row 6 -->
            <Button Content="0" Grid.Row="6" Grid.Column="0" Grid.ColumnSpan="2" Click="Digit_Click" />
            <Button Content="." Grid.Row="6" Grid.Column="2" Click="Decimal_Click" />
            <Button Content="+" Grid.Row="6" Grid.Column="3" Click="Operator_Click" Tag="+" />

            <!-- Row 7 -->
            <Button Content="Â±" Grid.Row="7" Grid.Column="0" Click="Sign_Click" />
            <Button Content="=" Grid.Row="7" Grid.Column="1" Grid.ColumnSpan="3" Click="Equals_Click"
                    Background="{DynamicResource AccentButtonBrush}" />
        </Grid>

    </Grid>
</Window>
